/* Generated by AN DISI Unibo */ 
/*
This code is generated only ONCE
*/
package it.unibo.simulator;
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.OutputStreamWriter;
import java.io.PrintWriter;
import java.net.ServerSocket;
import java.net.Socket;
import java.net.URLDecoder;

import it.unibo.connector.IConnector;
import it.unibo.connector.UnityConnector;
import it.unibo.is.interfaces.IOutputEnvView;
import it.unibo.qactors.QActorContext;

public class Simulator extends AbstractSimulator { 
	
	private ServerSocket server;
	private BufferedReader in;
	private PrintWriter out;
	
	public Simulator(String actorId, QActorContext myCtx, IOutputEnvView outEnvView )  throws Exception{
		
		super(actorId, myCtx, outEnvView);
	}
	
	public void initConnector(){
		
		try
		{
			server = new ServerSocket(6000);
			
			Socket client = server.accept();
			
			println("cliente accettato porta --> "+client.getPort());
			
			in = new BufferedReader(new InputStreamReader(client.getInputStream()));
			out = new PrintWriter(new BufferedWriter(new OutputStreamWriter(client.getOutputStream())), true);
			
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
	
	public void receiveEvent(){
		
		String message;
		try
		{
			while(true)
			{ 
				message = in.readLine();
				String decodedMsg = URLDecoder.decode(message, "UTF-8");
				println("[UnityConnector] Received data: " + decodedMsg);
				if(decodedMsg.contains("senseObstacle"))
				{
					
					//Thread.sleep(500);
					out.println("msg(obstaclefront,event,guimanager,none,obstaclefront,1)");
					out.flush();
					println("write Obstacle Front----------------");
				}
			}			
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}		
	}
}
